<div class="d-flex">
  <!-- Sidebar -->
  <div class="sidebar bg-dark text-white d-flex flex-column p-3" style="width: 220px; height: 100vh;">
    <h4 class="mb-4">Dashboard</h4>
    <div class="mb-3">
      <input type="text" class="form-control bg-secondary text-white border-0" placeholder="Search...">
    </div>
    <small class="text-muted text-uppercase">Navigation</small>
    <ul class="nav flex-column mt-2">
      <li class="nav-item">
        <button (click)="setSection('dashboard')" class="nav-link text-white bg-primary rounded mb-1 w-100 text-start">
          <i class="bi bi-house me-2"></i> Dashboard
        </button>
      </li>
      <li class="nav-item dropdown">
        <button class="nav-link dropdown-toggle w-100 text-start bg-transparent border-0 text-white mb-1"
                type="button" id="dropdownAnalytics" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-pie-chart me-2"></i> Analytics
        </button>
        <ul class="dropdown-menu dropdown-menu-dark w-100" aria-labelledby="dropdownAnalytics">
          <li><a class="dropdown-item text-white" href="#">Gráficas</a></li>
          <li><a class="dropdown-item text-white" href="#">Modelo</a></li>
          <li><a class="dropdown-item text-white" href="#" (click)="setSection('dashboard')">Mapa NL</a></li>
          <li><a class="dropdown-item text-white" href="#" (click)="setSection('dashboard-nacional')">Mapa Nacional</a></li>
        </ul>
      </li>
      <li class="nav-item">
        <button class="nav-link text-white mb-1 w-100 text-start bg-transparent border-0" (click)="setSection('user')">
          <i class="bi bi-person me-2"></i> User
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link text-white mb-1 w-100 text-start bg-transparent border-0" (click)="setSection('fileManager')">
          <i class="bi bi-folder me-2"></i> File Manager
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link text-white mb-1 w-100 text-start bg-transparent border-0" (click)="setSection('settings')">
          <i class="bi bi-gear me-2"></i> Setting
        </button>
      </li>
    </ul>
  </div>

  <!-- Main content -->
  <div class="p-4 flex-grow-1">

    <!-- Dashboard NL -->
    <div *ngIf="activeSection === 'dashboard'" class="d-flex">
      <div class="flex-grow-1" style="height: auto; position: relative;">
        <h1>Centros de distribución de Nuevo León</h1>
        <p>Este es tu panel principal.</p>
        <div class="mb-3">
          <button class="btn btn-outline-primary me-2" (click)="setSection('dashboard')">Ver NL</button>
          <button class="btn btn-outline-secondary" (click)="setSection('dashboard-nacional')">Ver Nacional</button>
        </div>
        <div class="card shadow-sm border-0 rounded-4 overflow-hidden" style="height: 320px;">
          <div id="map" style="height: 100%; width: 100%;"></div>
        </div>
      </div>
      <div *ngIf="selectedFeatureProps" class="bg-light border-start p-3" style="width: 320px; height: 320px; overflow-y: auto;">
        <h5>Centro #{{ selectedFeatureProps['Centro_ID'] }}</h5>
        <p><strong>Latitud:</strong> {{ selectedFeatureProps['latitude'] }}</p>
        <p><strong>Longitud:</strong> {{ selectedFeatureProps['longitude'] }}</p>
        <button class="btn btn-sm btn-outline-secondary mt-3" (click)="selectedFeatureProps = null">Cerrar</button>
      </div>
    </div>

    <!-- Dashboard Nacional -->
    <div *ngIf="activeSection === 'dashboard-nacional'" class="d-flex flex-column gap-4">
      <div class="flex-grow-1" style="height: auto; position: relative; max-width: 100%;">
        <h1>Centros de distribución Nacional</h1>
        <p>Visualización a nivel nacional.</p>
        <div class="mb-3">
          <button class="btn btn-outline-secondary me-2" (click)="setSection('dashboard')">Ver NL</button>
          <button class="btn btn-outline-primary" (click)="setSection('dashboard-nacional')">Ver Nacional</button>
        </div>
        <div class="card shadow-sm border-0 rounded-4 overflow-hidden mb-4" style="height: 320px;">
          <div id="mapNacional" style="height: 100%; width: 100%;"></div>
        </div>
      </div>

      <!-- Gráficas y tabla desde backend -->
      <div>
        <h2 class="mb-4">Análisis Nacional</h2>

        <!-- Gráfica de barras: Top Productos -->
        <div class="mb-5">
          <h5>Top 5 Productos</h5>
          <canvas baseChart
                  [data]="barChartDataProductos"
                  [type]="barChartType">
          </canvas>
        </div>

        <!-- Gráfica de barras: Productos por día -->
        <div class="mb-5">
          <h5>Productos entregados por día</h5>
          <canvas baseChart
                  [data]="barChartDataDia"
                  [type]="barChartType">
          </canvas>
        </div>

        <!-- Gráfica de pastel: Porcentaje por zona -->
        <div class="mb-5">
          <h5>Distribución por Zona</h5>
          <canvas baseChart
                  [data]="pieChartDataZona"
                  [type]="pieChartType">
          </canvas>
        </div>

        <!-- Tabla resumen -->
        <div class="mb-5">
          <h5>Desempeño por Estado</h5>
          <table class="table table-bordered table-hover table-sm">
            <thead class="table-light">
              <tr>
                <th>Estado</th>
                <th>Ordenes</th>
                <th>Tiempo promedio</th>
                <th>Porcentaje a tiempo</th>
                <th>Desempeño</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let fila of resumenTabla">
                <td>{{ fila.estado_del_cliente }}</td>
                <td>{{ fila.Ordenes }}</td>
                <td>{{ fila['Tiempo promedio'] }}</td>
                <td>{{ fila['Porcentaje a tiempo'] }}</td>
                <td>{{ fila['EstadoDesempeño'] }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>
